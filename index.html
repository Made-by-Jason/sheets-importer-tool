<html>
  <head>
    <base href=".">
    <title>Spreadsheet Data Import Tool</title>
    <style>
      :root {
        --google-blue: #4285f4;
        --google-red: #ea4335;
        --google-yellow: #fbbc05;
        --google-green: #34a853;
      }

      body {
        font-family: 'Roboto', Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f8f9fa;
      }

      .header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }

      .logo {
        margin-right: 15px;
      }

      .tool-name {
        font-size: 24px;
        color: #202124;
      }

      .main-container {
        display: grid;
        grid-template-columns: 250px 1fr;
        gap: 20px;
        min-height: calc(100vh - 80px);
        margin: 0;
        padding: 0;
      }

      .sidebar {
        background: white;
        padding: 20px;
        border-right: 1px solid #dadce0;
        height: 100%;
      }

      .sidebar-menu {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .sidebar-menu li {
        padding: 12px 15px;
        cursor: pointer;
        border-radius: 4px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .sidebar-menu li:hover {
        background: #f1f3f4;
      }

      .sidebar-menu li.active {
        background: var(--google-blue);
        color: white;
      }

      .content-area {
        padding: 20px;
        background: white;
        border-radius: 8px;
      }

      .operation-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }

      .operation-card {
        border: 1px solid #dadce0;
        border-radius: 8px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        height: 160px;
      }

      .operation-card:hover {
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transform: translateY(-2px);
      }

      .operation-icon {
        width: 24px;
        height: 24px;
        margin-bottom: 10px;
      }

      .operation-title {
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 8px;
      }

      .operation-description {
        font-size: 14px;
        color: #5f6368;
        margin-bottom: 35px;
      }

      .button {
        background: var(--google-blue);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
        position: absolute;
        bottom: 15px;
      }

      .button:hover {
        background: #3367d6;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
      }

      .modal-content {
        position: relative;
        background: white;
        margin: 50px auto;
        padding: 20px;
        width: 80%;
        max-width: 600px;
        border-radius: 8px;
      }

      .modal-close {
        position: absolute;
        right: 20px;
        top: 20px;
        cursor: pointer;
        font-size: 24px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }

      .form-group input, .form-group select {
        width: 100%;
        padding: 8px;
        border: 1px solid #dadce0;
        border-radius: 4px;
      }

      .schedule-options {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-bottom: 15px;
      }

      .schedule-option {
        padding: 10px;
        border: 1px solid #dadce0;
        border-radius: 4px;
        text-align: center;
        cursor: pointer;
      }

      .schedule-option.selected {
        background: var(--google-blue);
        color: white;
      }

      .workflow-step {
        border: 1px solid #dadce0;
        border-radius: 4px;
        padding: 10px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .step-header {
        font-weight: 500;
      }

      textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #dadce0;
        border-radius: 4px;
        font-family: monospace;
      }

      .stats-bar {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #dadce0;
      }

      .stat-value {
        font-size: 24px;
        font-weight: 500;
        color: var(--google-blue);
      }

      .stat-label {
        font-size: 14px;
        color: #5f6368;
        margin-top: 5px;
      }

      .tab-content {
        padding: 20px;
      }

      .grid-3 {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 20px;
      }

      .metric-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .metric-value {
        font-size: 24px;
        font-weight: 500;
        color: var(--google-blue);
        margin-top: 10px;
      }

      .source-item,
      .workflow-item,
      .schedule-item,
      .notification-item {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .source-header,
      .workflow-header,
      .schedule-header,
      .notification-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
      }

      .badge.active {
        background: var(--google-green);
        color: white;
      }

      .badge.inactive {
        background: var(--google-red);
        color: white;
      }

      .workflow-steps {
        display: flex;
        gap: 10px;
        margin: 15px 0;
      }

      .workflow-step {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px;
        background: #f1f3f4;
        border-radius: 4px;
      }

      .step-number {
        background: var(--google-blue);
        color: white;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
      }

      .settings-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .user-list {
        margin-top: 15px;
      }

      .user-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
      }

      .notification-status {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
      }

      .notification-status.completed {
        background: var(--google-green);
        color: white;
      }

      .notification-status.failed {
        background: var(--google-red);
        color: white;
      }

      .notification-time {
        color: #5f6368;
        font-size: 14px;
      }

      .metric-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .metric-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .metric-title {
        font-size: 14px;
        color: #5f6368;
        margin-bottom: 8px;
      }

      .metric-value {
        font-size: 24px;
        font-weight: 500;
        color: var(--google-blue);
      }

      .metric-change {
        font-size: 12px;
        margin-top: 4px;
      }

      .metric-change.positive {
        color: var(--google-green);
      }

      .metric-change.negative {
        color: var(--google-red);
      }

      .status-window {
        background: #1e1e1e;
        color: #fff;
        padding: 15px;
        border-radius: 8px;
        font-family: monospace;
        margin-top: 20px;
        max-height: 300px;
        overflow-y: auto;
      }

      .status-entry {
        margin-bottom: 8px;
        padding: 4px 8px;
        border-left: 3px solid transparent;
      }

      .status-entry.info {
        border-color: var(--google-blue);
      }

      .status-entry.success {
        border-color: var(--google-green);
      }

      .status-entry.error {
        border-color: var(--google-red);
      }

      .status-entry.warning {
        border-color: var(--google-yellow);
      }
    </style>
  </head>
  <body>
    <div class="header">
      <svg class="logo" width="40" height="40" viewBox="0 0 40 40">
        <rect width="40" height="40" rx="8" fill="#34a853"/>
        <path d="M10 10h20v20h-20z" fill="white"/>
        <rect x="13" y="13" width="14" height="2" fill="#34a853"/>
        <rect x="13" y="17" width="14" height="2" fill="#34a853"/>
        <rect x="13" y="21" width="14" height="2" fill="#34a853"/>
        <rect x="13" y="25" width="14" height="2" fill="#34a853"/>
      </svg>
      <div class="tool-name">Sheets Data Import Tool</div>
    </div>
    <div class="main-container">
      <div class="sidebar">
        <ul class="sidebar-menu">
          <li class="active" data-tab="dashboard">
            <svg class="menu-icon" width="24" height="24" viewBox="0 0 24 24">
              <path fill="currentColor" d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
            </svg>
            Dashboard
          </li>
          <li data-tab="dataSources">
            <svg class="menu-icon" width="24" height="24" viewBox="0 0 24 24">
              <path fill="currentColor" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
            </svg>
            Data Sources
          </li>
          <li data-tab="workflows">
            <svg class="menu-icon" width="24" height="24" viewBox="0 0 24 24">
              <path fill="currentColor" d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"/>
            </svg>
            Workflows
          </li>
          <li data-tab="schedule">
            <svg class="menu-icon" width="24" height="24" viewBox="0 0 24 24">
              <path fill="currentColor" d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
            </svg>
            Schedule
          </li>
          <li data-tab="notifications">
            <svg class="menu-icon" width="24" height="24" viewBox="0 0 24 24">
              <path fill="currentColor" d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
            </svg>
            Notifications
          </li>
          <li data-tab="settings">
            <svg class="menu-icon" width="24" height="24" viewBox="0 0 24 24">
              <path fill="currentColor" d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49 1c-.23.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49-1c.23-.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
            </svg>
            Settings
          </li>
        </ul>
      </div>
      <div class="content-area">
        <!-- Tab content will be generated dynamically -->
      </div>
    </div>

    <!-- API Configuration Modal -->
    <div id="apiModal" class="modal">
      <div class="modal-content">
        <span class="modal-close" onclick="hideApiModal()">&#xd7;</span>
        <h2>API Configuration</h2>
        <div class="form-group">
          <label>API Endpoint</label>
          <input type="text" id="apiEndpoint" placeholder="https://api.example.com/data">
        </div>
        <div class="form-group">
          <label>Authentication Method</label>
          <select id="authMethod">
            <option value="none">No Auth</option>
            <option value="basic">Basic Auth</option>
            <option value="bearer">Bearer Token</option>
            <option value="apikey">API Key</option>
          </select>
        </div>
        <div class="form-group">
          <label>Destination Sheet</label>
          <input type="text" id="destinationSheet" placeholder="Sheet ID or Name">
        </div>
        <button class="button" onclick="saveApiConfig()">Save Configuration</button>
      </div>
    </div>

    <!-- Schedule Modal -->
    <div id="scheduleModal" class="modal">
      <div class="modal-content">
        <span class="modal-close" onclick="hideScheduleModal()">&#xd7;</span>
        <h2>Schedule Configuration</h2>
        <div class="schedule-options">
          <div class="schedule-option" onclick="selectSchedule(this)" data-interval="hourly">Hourly</div>
          <div class="schedule-option" onclick="selectSchedule(this)" data-interval="daily">Daily</div>
          <div class="schedule-option" onclick="selectSchedule(this)" data-interval="weekly">Weekly</div>
        </div>
        <div class="form-group">
          <label>Start Time</label>
          <input type="time" id="scheduleTime">
        </div>
        <div class="form-group">
          <label>Select API Task</label>
          <select id="apiTask">
            <option value="">Select API Configuration</option>
          </select>
        </div>
        <button class="button" onclick="saveSchedule()">Save Schedule</button>
      </div>
    </div>

    <!-- Data Transformation Modal -->
    <div id="transformModal" class="modal">
      <div class="modal-content">
        <span class="modal-close" onclick="hideTransformModal()">&#xd7;</span>
        <h2>Data Transformation</h2>
        <div class="form-group">
          <label>Transform Type</label>
          <select id="transformType">
            <option value="format">Format Data</option>
            <option value="aggregate">Aggregate</option>
            <option value="filter">Filter</option>
            <option value="join">Join Data</option>
            <option value="pivot">Pivot Table</option>
          </select>
        </div>
        <div class="form-group">
          <label>Source Columns</label>
          <input type="text" id="sourceColumns" placeholder="Column names separated by comma">
        </div>
        <div class="form-group">
          <label>Transform Expression</label>
          <textarea id="transformExpression" rows="4" placeholder="Enter transform expression or SQL-like query"></textarea>
        </div>
        <button class="button" onclick="saveTransform()">Save Transform</button>
      </div>
    </div>

    <!-- Workflow Builder Modal -->
    <div id="workflowModal" class="modal">
      <div class="modal-content">
        <span class="modal-close" onclick="hideWorkflowModal()">&#xd7;</span>
        <h2>Workflow Builder</h2>
        <div id="workflowSteps">
          <!-- Steps will be added dynamically -->
        </div>
        <div class="form-group">
          <label>Step Type</label>
          <select id="stepType">
            <option value="import">Import Data</option>
            <option value="transform">Transform</option>
            <option value="validate">Validate</option>
            <option value="export">Export</option>
          </select>
        </div>
        <button class="button" onclick="addWorkflowStep()">Add Step</button>
        <button class="button" onclick="saveWorkflow()">Save Workflow</button>
      </div>
    </div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
      let configurations = {
        api: [],
        schedules: [],
        transforms: [],
        workflows: []
      };
      let dataStore = {
        importedData: [],
        columnMappings: {},
        validationRules: [],
        formatRules: [],
        syncSettings: {},
        errorHandling: {
          retryAttempts: 3,
          notifications: true
        },
        importHistory: [],
        accessControl: {
          users: [],
          permissions: {}
        },
        dataSources: []
      };
      let statusLog = [];
      let currentTab = 'dashboard';

      function logStatus(message, type = 'info') {
        const entry = {
          timestamp: new Date(),
          message,
          type
        };
        statusLog.push(entry);
        updateStatusWindow();
      }

      function updateStatusWindow() {
        const statusWindow = document.querySelector('.status-window');
        if (!statusWindow) return;
        
        statusWindow.innerHTML = statusLog.map(entry => `
          <div class="status-entry ${entry.type}">
            <span class="status-time">[${entry.timestamp.toLocaleTimeString()}]</span>
            ${entry.message}
          </div>
        `).join('');
        
        statusWindow.scrollTop = statusWindow.scrollHeight;
      }

      function getMetricChange(current, previous) {
        if (!previous) return null;
        const change = ((current - previous) / previous) * 100;
        return {
          value: Math.abs(change).toFixed(1),
          direction: change >= 0 ? 'positive' : 'negative'
        };
      }

      const tabContent = {
        dashboard: {
          title: 'Dashboard',
          stats: true,
          operations: true
        },
        dataSources: {
          title: 'Data Sources',
          content: {
            sources: [], // Array of connected data sources
            metrics: {}  // Source performance metrics
          } 
        },
        workflows: {
          title: 'Workflows',
          content: {
            active: [], // Active workflow configs
            history: [] // Workflow execution history  
          }
        },
        schedule: {
          title: 'Schedule',
          content: {
            tasks: [], // Scheduled tasks
            calendar: {} // Calendar view of schedules
          }
        },
        notifications: {
          title: 'Notifications',
          content: {
            alerts: [], // System notifications
            settings: {} // Notification preferences
          }
        },
        settings: {
          title: 'Settings', 
          content: {
            account: {}, // Account settings
            preferences: {} // App preferences
          }
        }
      };

      function displayTabContent(tabId) {
        currentTab = tabId;
        const content = document.querySelector('.content-area');
        
        if (!tabId) return;

        content.innerHTML = '';
        
        const tab = tabContent[tabId];
        
        if (!tab) return;

        const header = document.createElement('h2');
        header.textContent = tab.title;
        content.appendChild(header);

        if (tabId === 'dashboard') {
          if (tab.stats) {
            const metricElements = createStatsBar();
            metricElements.forEach(element => content.appendChild(element));
          }
          if (tab.operations) {
            content.appendChild(createOperationsGrid()); 
          }
          return;
        }

        const tabContentEl = document.createElement('div');
        tabContentEl.className = 'tab-content';

        switch(tabId) {
          case 'dataSources':
            tabContentEl.appendChild(createDataSourcesView());
            break;
          case 'workflows':
            tabContentEl.appendChild(createWorkflowsView());
            break;
          case 'schedule': 
            tabContentEl.appendChild(createScheduleView());
            break;
          case 'notifications':
            tabContentEl.appendChild(createNotificationsView());
            break;
          case 'settings':
            tabContentEl.appendChild(createSettingsView());
            break;
        }

        content.appendChild(tabContentEl);
      }

      function createDataSourcesView() {
        const view = document.createElement('div');
        view.className = 'data-sources-view';
        const toolbar = document.createElement('div');
        toolbar.innerHTML = `<button class="button" style="position:static" onclick="manageDataSources()">Add Source</button>`;
        view.appendChild(toolbar);

        const metrics = document.createElement('div');
        metrics.className = 'source-metrics grid-3';
        metrics.innerHTML = `
          <div class="metric-card">
            <h3>Connected Sources</h3>
            <div class="metric-value">${dataStore.dataSources.length}</div>
          </div>
          <div class="metric-card">
            <h3>Active Connections</h3>
            <div class="metric-value">${dataStore.dataSources.filter(s => s.active).length}</div>
          </div>
          <div class="metric-card">
            <h3>Total Records</h3>
            <div class="metric-value">${calculateTotalRecords()}</div>
          </div>
        `;
        view.appendChild(metrics);

        const sources = document.createElement('div'); 
        sources.className = 'source-list';
        dataStore.dataSources.forEach(source => {
          const sourceEl = document.createElement('div');
          sourceEl.className = 'source-item';
          sourceEl.innerHTML = `
            <div class="source-header">
              <h4>${source.name}</h4>
              <span class="badge ${source.active ? 'active' : 'inactive'}">
                ${source.active ? 'Active' : 'Inactive'}
              </span>
            </div>
            <div class="source-details">
              <div>Type: ${source.type}</div>
              <div>Connection: ${source.connection}</div>
              <div>Records: ${source.records}</div>
            </div>
            <div class="source-actions">
              <button onclick="editSource(${source.id})">Edit</button>
              <button onclick="toggleSource(${source.id})">${source.active ? 'Deactivate' : 'Activate'}</button>
              <button onclick="removeSource(${source.id})">Remove</button>
            </div>
          `;
          sources.appendChild(sourceEl);
        });
        view.appendChild(sources);

        return view;
      }

      function createWorkflowsView() {
        const view = document.createElement('div');
        view.className = 'workflows-view';
        const toolbar = document.createElement('div');
        toolbar.innerHTML = `<button class="button" style="position:static" onclick="showWorkflowModal()">New Workflow</button>`;
        view.appendChild(toolbar);

        const metrics = document.createElement('div');
        metrics.className = 'workflow-metrics grid-3';
        metrics.innerHTML = `
          <div class="metric-card">
            <h3>Active Workflows</h3>
            <div class="metric-value">${configurations.workflows.length}</div>
          </div>
          <div class="metric-card">
            <h3>Completed Tasks</h3>
            <div class="metric-value">${dataStore.importHistory.length}</div>
          </div>
          <div class="metric-card">
            <h3>Success Rate</h3>
            <div class="metric-value">${calculateSuccessRate()}%</div>
          </div>
        `;
        view.appendChild(metrics);

        const workflows = document.createElement('div');
        workflows.className = 'workflow-list';
        configurations.workflows.forEach(workflow => {
          const workflowEl = document.createElement('div');
          workflowEl.className = 'workflow-item';
          workflowEl.innerHTML = `
            <div class="workflow-header">
              <h4>Workflow ${workflow.id}</h4>
            </div>
            <div class="workflow-steps">
              ${workflow.steps.map((step, i) => `
                <div class="workflow-step">
                  <span class="step-number">${i + 1}</span>
                  <span class="step-type">${step}</span>
                </div>
              `).join('')}
            </div>
            <div class="workflow-actions">
              <button onclick="editWorkflow(${workflow.id})">Edit</button>
              <button onclick="runWorkflow(${workflow.id})">Run</button>
              <button onclick="deleteWorkflow(${workflow.id})">Delete</button>
            </div>
          `;
          workflows.appendChild(workflowEl);
        });
        view.appendChild(workflows);

        return view;
      }

      function createScheduleView() {
        const view = document.createElement('div');
        view.className = 'schedule-view';
        const toolbar = document.createElement('div');
        toolbar.innerHTML = `<button class="button" style="position:static" onclick="showScheduleModal()">New Schedule</button>`;
        view.appendChild(toolbar);

        const metrics = document.createElement('div');
        metrics.className = 'schedule-metrics grid-3';
        metrics.innerHTML = `
          <div class="metric-card">
            <h3>Scheduled Tasks</h3>
            <div class="metric-value">${configurations.schedules.length}</div>
          </div>
          <div class="metric-card">
            <h3>Next Run</h3>
            <div class="metric-value">${getNextScheduledRun()}</div>
          </div>
          <div class="metric-card">
            <h3>Last Run</h3>
            <div class="metric-value">${getLastScheduledRun()}</div>
          </div>
        `;
        view.appendChild(metrics);

        const schedules = document.createElement('div');
        schedules.className = 'schedule-list';
        configurations.schedules.forEach(schedule => {
          const scheduleEl = document.createElement('div');
          scheduleEl.className = 'schedule-item';
          scheduleEl.innerHTML = `
            <div class="schedule-header">
              <h4>Schedule ${schedule.id}</h4>
            </div>
            <div class="schedule-details">
              <div>Interval: ${schedule.interval}</div>
              <div>Time: ${schedule.time}</div>
              <div>Task: ${getTaskName(schedule.taskId)}</div>
            </div>
            <div class="schedule-actions">
              <button onclick="editSchedule(${schedule.id})">Edit</button>
              <button onclick="toggleSchedule(${schedule.id})">Toggle</button>
              <button onclick="deleteSchedule(${schedule.id})">Delete</button>
            </div>
          `;
          schedules.appendChild(scheduleEl);
        });
        view.appendChild(schedules);

        return view;
      }

      function createNotificationsView() {
        const view = document.createElement('div');
        view.className = 'notifications-view';

        const controls = document.createElement('div');
        controls.className = 'notification-controls';
        controls.innerHTML = `
          <div class="notification-toggles">
            <label>
              <input type="checkbox" 
                     ${dataStore.errorHandling.notifications ? 'checked' : ''}
                     onchange="toggleNotifications(this.checked)">
              Enable Notifications
            </label>
          </div>
        `;
        view.appendChild(controls);

        const notifications = document.createElement('div');
        notifications.className = 'notification-list';
        dataStore.importHistory.forEach(entry => {
          const notificationEl = document.createElement('div');
          notificationEl.className = 'notification-item';
          notificationEl.innerHTML = `
            <div class="notification-header">
              <span class="notification-time">${formatDate(entry.date)}</span>
              <span class="notification-status ${entry.status.toLowerCase()}">
                ${entry.status}
              </span>
            </div>
            <div class="notification-content">
              Import from ${entry.source}
            </div>
          `;
          notifications.appendChild(notificationEl);
        });
        view.appendChild(notifications);

        return view;
      }

      function createSettingsView() {
        const view = document.createElement('div');
        view.className = 'settings-view';

        view.innerHTML = `
          <div class="settings-section">
            <h3>Account Settings</h3>
            <div class="form-group">
              <label>Email Notifications</label>
              <select onchange="updateEmailPreference(this.value)">
                <option value="all">All Updates</option>
                <option value="important">Important Only</option>
                <option value="none">None</option>
              </select>
            </div>
            <div class="form-group">
              <label>Default Data Source</label>
              <select onchange="updateDefaultSource(this.value)">
                ${dataStore.dataSources.map(source => `
                  <option value="${source.id}">${source.name}</option>
                `).join('')}
              </select>
            </div>
          </div>

          <div class="settings-section">
            <h3>API Settings</h3>
            <div class="form-group">
              <label>Retry Attempts</label>
              <input type="number" 
                     value="${dataStore.errorHandling.retryAttempts}"
                     onchange="updateRetryAttempts(this.value)">
            </div>
          </div>

          <div class="settings-section">
            <h3>Access Control</h3>
            <div class="user-list">
              ${dataStore.accessControl.users.map(user => `
                <div class="user-item">
                  <span>${user}</span>
                  <button onclick="revokeAccess('${user}')">Revoke</button>
                </div>
              `).join('')}
            </div>
          </div>
        `;

        return view;
      }

      function importFromUrl() {
        const url = prompt("Enter Google Sheet URL:");
        if (!url) return;
        try {
          const sheetId = url.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/)[1];
          fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet1`, {
            headers: {
              'Authorization': 'Bearer ' + getGoogleAuthToken()
            }
          }).then(response => response.json()).then(data => {
            dataStore.importedData = data.values;
            alert("Data imported successfully!");
          });
        } catch (err) {
          alert("Invalid Google Sheets URL");
        }
      }

      function importFromXml() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.xml';
        input.onchange = e => {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = async e => {
            const parser = new DOMParser();
            const xml = parser.parseFromString(e.target.result, "text/xml");
            const data = await parseXMLToArray(xml);
            dataStore.importedData = data;
            alert("XML data imported successfully!");
          };
          reader.readAsText(file);
        };
        input.click();
      }

      function mapColumns() {
        if (!dataStore.importedData.length) {
          alert("Please import data first");
          return;
        }
        const headers = dataStore.importedData[0];
        let mappings = {};
        headers.forEach(header => {
          const mapping = prompt(`Map column "${header}" to:`);
          if (mapping) {
            mappings[header] = mapping;
          }
        });
        dataStore.columnMappings = mappings;
        alert("Column mapping completed!");
      }

      function validateData() {
        logStatus('Starting data validation...', 'info');
        const errors = [];
        dataStore.importedData.forEach((row, i) => {
          if (i === 0) return;
          dataStore.validationRules.forEach(rule => {
            const colIndex = dataStore.importedData[0].indexOf(rule.column);
            const value = row[colIndex];
            if (!validateValue(value, rule.type)) {
              errors.push(`Row ${i + 1}, Column ${rule.column}: Invalid ${rule.type}`);
            }
          });
        });
        if (errors.length) {
          logStatus(`Validation failed with ${errors.length} errors`, 'error');
          alert(`Validation errors found:\n${errors.join('\n')}`);
        } else {
          logStatus('Data validation completed successfully', 'success');
          alert("All data validated successfully!");
        }
      }

      function validateValue(value, type) {
        switch (type.toLowerCase()) {
          case 'number':
            return !isNaN(value);
          case 'email':
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
          case 'text':
            return typeof value === 'string';
          default:
            return true;
        }
      }

      function applyFormatting() {
        dataStore.importedData = dataStore.importedData.map((row, i) => {
          if (i === 0) return row;
          return row.map((cell, j) => {
            const header = dataStore.importedData[0][j];
            const rule = dataStore.formatRules.find(r => r.column === header);
            if (rule) {
              return formatValue(cell, rule.format);
            }
            return cell;
          });
        });
        alert("Formatting applied successfully!");
      }

      function formatValue(value, format) {
        switch (format.toLowerCase()) {
          case 'currency':
            return new Intl.NumberFormat('en-US', {
              style: 'currency',
              currency: 'USD'
            }).format(value);
          case 'date':
            return new Date(value).toLocaleDateString();
          case 'number':
            return new Intl.NumberFormat().format(value);
          default:
            return value;
        }
      }

      function configureSync() {
        const interval = prompt("Enter sync interval (in minutes):");
        const enabled = confirm("Enable auto-sync?");
        dataStore.syncSettings = {
          interval: parseInt(interval),
          enabled,
          lastSync: new Date()
        };
        if (enabled && interval) {
          setInterval(() => {
            if (dataStore.syncSettings.enabled) {
              performSync();
            }
          }, interval * 60 * 1000);
        }
        alert("Sync settings saved!");
      }

      function performSync() {
        logStatus('Starting data sync...', 'info');
        dataStore.syncSettings.lastSync = new Date();
        dataStore.importHistory.push({
          date: new Date().toISOString(),
          source: "Auto-sync",
          status: "Completed"
        });
        logStatus('Data sync completed successfully', 'success');
      }

      function configureErrorHandling() {
        const retryAttempts = prompt("Enter number of retry attempts:", 3);
        const notifications = confirm("Enable error notifications?");
        dataStore.errorHandling = {
          retryAttempts: parseInt(retryAttempts),
          notifications
        };
        alert("Error handling settings saved!");
      }

      function viewImportHistory() {
        if (!dataStore.importHistory.length) {
          alert("No import history available");
          return;
        }
        let history = "Import History:\n\n";
        dataStore.importHistory.forEach((entry, i) => {
          history += `${i + 1}. ${entry.date} - ${entry.source} - ${entry.status}\n`;
        });
        alert(history);
      }

      function manageAccessControl() {
        const user = prompt("Enter user email:");
        if (!user) return;
        const permissions = {
          import: confirm("Allow import?"),
          export: confirm("Allow export?"),
          modify: confirm("Allow modifications?")
        };
        dataStore.accessControl.users.push(user);
        dataStore.accessControl.permissions[user] = permissions;
        alert("Access control updated!");
      }

      function manageDataSources() {
        const name = prompt("Enter data source name:");
        if (!name) return;
        const type = prompt("Enter source type (API/Database/File):");
        const connection = prompt("Enter connection string or URL:");
        dataStore.dataSources.push({
          id: Date.now(),
          name,
          type,
          connection,
          active: true,
          records: Math.floor(Math.random()*1000)
        });
        alert("Data source added successfully!");
        updateStats(); 
        if (currentTab === 'dataSources') displayTabContent('dataSources');
      }

      function showApiModal() {
        document.getElementById("apiModal").style.display = "block";
      }

      function hideApiModal() {
        document.getElementById("apiModal").style.display = "none";
      }

      function saveApiConfig() {
        logStatus('Saving new API configuration...', 'info');
        const endpoint = document.getElementById('apiEndpoint').value;
        const authMethod = document.getElementById('authMethod').value;
        const destination = document.getElementById('destinationSheet').value;
        if (!endpoint || !destination) {
          alert('Please fill in all required fields');
          return;
        }
        configurations.api.push({
          endpoint,
          authMethod,
          destination,
          id: Date.now()
        });
        updateApiTaskDropdown();
        logStatus(`API endpoint "${endpoint}" configured successfully`, 'success');
        hideApiModal();
        updateStats();
      }

      function showScheduleModal() {
        document.getElementById("scheduleModal").style.display = "block";
      }

      function hideScheduleModal() {
        document.getElementById("scheduleModal").style.display = "none";
      }

      function selectSchedule(option) {
        const options = document.querySelectorAll('.schedule-option');
        options.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
      }

      function saveSchedule() {
        logStatus('Creating new schedule...', 'info');
        const selectedOption = document.querySelector('.schedule-option.selected');
        const time = document.getElementById('scheduleTime').value;
        const taskId = document.getElementById('apiTask').value;
        if (!selectedOption || !time || !taskId) {
          alert('Please complete all schedule settings');
          return;
        }
        configurations.schedules.push({
          interval: selectedOption.dataset.interval,
          time,
          taskId,
          id: Date.now()
        });
        logStatus(`Schedule created: ${selectedOption.dataset.interval} at ${time}`, 'success');
        hideScheduleModal();
        updateStats();
      }

      function showTransformModal() {
        document.getElementById("transformModal").style.display = "block";
      }

      function hideTransformModal() {
        document.getElementById("transformModal").style.display = "none";
      }

      function saveTransform() {
        const type = document.getElementById('transformType').value;
        const columns = document.getElementById('sourceColumns').value;
        const expression = document.getElementById('transformExpression').value;
        if (!type || !columns || !expression) {
          alert('Please complete all transform settings');
          return;
        }
        configurations.transforms.push({
          type,
          columns: columns.split(',').map(c => c.trim()),
          expression,
          id: Date.now()
        });
        hideTransformModal();
      }

      function showWorkflowModal() {
        document.getElementById("workflowModal").style.display = "block";
      }

      function hideWorkflowModal() {
        document.getElementById("workflowModal").style.display = "none";
      }

      function addWorkflowStep() {
        const stepType = document.getElementById('stepType').value;
        const stepsContainer = document.getElementById('workflowSteps');
        const step = document.createElement('div');
        step.className = 'workflow-step';
        step.innerHTML = `
          <div class="step-header">${stepType}</div>
          <button onclick="removeWorkflowStep(this)">Remove</button>
        `;
        stepsContainer.appendChild(step);
      }

      function removeWorkflowStep(button) {
        button.parentElement.remove();
      }

      function saveWorkflow() {
        const steps = Array.from(document.querySelectorAll('.workflow-step')).map(step => step.querySelector('.step-header').textContent);
        if (steps.length === 0) {
          alert('Please add at least one workflow step');
          return;
        }
        configurations.workflows.push({
          steps,
          id: Date.now()
        });
        hideWorkflowModal();
        updateStats();
      }

      function updateApiTaskDropdown() {
        const select = document.getElementById('apiTask');
        select.innerHTML = '<option value="">Select API Configuration</option>';
        configurations.api.forEach(api => {
          const option = document.createElement('option');
          option.value = api.id;
          option.textContent = api.endpoint;
          select.appendChild(option);
        });
      }

      function getGoogleAuthToken() {
        return localStorage.getItem('googleAuthToken');
      }

      async function parseXMLToArray(xml) {
        const rows = xml.getElementsByTagName('row');
        return Array.from(rows).map(row => {
          return Array.from(row.children).map(cell => cell.textContent);
        });
      }

      function updateStats() {
        try { updateStatusWindow(); } catch(e){}
        if (currentTab === 'dashboard') displayTabContent('dashboard');
      }

      function calculateSuccessRate() {
        const total = dataStore.importHistory.length;
        if (!total) return 100;
        const successful = dataStore.importHistory.filter(h => h.status === 'Completed').length;
        return Math.round(successful / total * 100);
      }

      function calculateTotalRecords() {
        return dataStore.importedData.reduce((sum, row) => sum + (Array.isArray(row) ? row.length : 0), 0);
      }

      function formatNumber(num) {
        if (num >= 1000000) {
          return (num / 1000000).toFixed(1) + 'M';
        }
        if (num >= 1000) {
          return (num / 1000).toFixed(1) + 'K';
        }
        return num;
      }

      function createStatsBar() {
        const metricsContainer = document.createElement('div');
        metricsContainer.className = 'metric-grid';

        const metrics = [
          {
            title: 'Active Workflows',
            value: configurations.workflows.length,
            change: getMetricChange(configurations.workflows.length, configurations.workflows.length - 1)
          },
          {
            title: 'API Endpoints',
            value: configurations.api.length,
            change: getMetricChange(configurations.api.length, configurations.api.length - 1)
          },
          {
            title: 'Success Rate',
            value: calculateSuccessRate() + '%',
            change: getMetricChange(calculateSuccessRate(), calculateSuccessRate() - 5)
          },
          {
            title: 'Records Processed',
            value: formatNumber(calculateTotalRecords()),
            change: getMetricChange(calculateTotalRecords(), calculateTotalRecords() - 100)
          },
          {
            title: 'Active Sources',
            value: dataStore.dataSources.filter(s => s.active).length,
            change: null
          },
          {
            title: 'Scheduled Tasks',
            value: configurations.schedules.length,
            change: getMetricChange(configurations.schedules.length, configurations.schedules.length - 1)
          }
        ];

        metrics.forEach(metric => {
          const card = document.createElement('div');
          card.className = 'metric-card';
          card.innerHTML = `
            <div class="metric-title">${metric.title}</div>
            <div class="metric-value">${metric.value}</div>
            ${metric.change ? `
              <div class="metric-change ${metric.change.direction}">
                ${metric.change.direction === 'positive' ? '↑' : '↓'} ${metric.change.value}%
              </div>
            ` : ''}
          `;
          metricsContainer.appendChild(card);
        });

        const statusWindow = document.createElement('div');
        statusWindow.className = 'status-window';
  
        return [metricsContainer, statusWindow];
      }

      document.querySelectorAll('.sidebar-menu li').forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.sidebar-menu li').forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          const tabId = item.dataset.tab || 'dashboard';
          displayTabContent(tabId);
        });
      });

      displayTabContent('dashboard');

      function editSource(id){ 
        const s = dataStore.dataSources.find(x => x.id === id); 
        if(!s) return;
        const name = prompt("Source name:", s.name) || s.name;
        const connection = prompt("Connection:", s.connection) || s.connection;
        s.name = name; 
        s.connection = connection; 
        updateStats(); 
        if(currentTab === 'dataSources') displayTabContent('dataSources');
      }

      function toggleSource(id){ 
        const s = dataStore.dataSources.find(x => x.id === id); 
        if(!s) return;
        s.active = !s.active; 
        updateStats(); 
        if(currentTab === 'dataSources') displayTabContent('dataSources');
      }

      function removeSource(id){ 
        dataStore.dataSources = dataStore.dataSources.filter(x => x.id !== id);
        updateStats(); 
        if(currentTab === 'dataSources') displayTabContent('dataSources');
      }

      function editWorkflow(id){ 
        alert(`Edit workflow ${id} (open builder)`); 
        showWorkflowModal(); 
      }

      function runWorkflow(id){
        logStatus(`Running workflow ${id}...`,'info');
        setTimeout(()=>{ 
          dataStore.importHistory.push({date:new Date().toISOString(),source:`Workflow ${id}`,status:'Completed'}); 
          logStatus(`Workflow ${id} completed`,'success'); 
          updateStats();
        },800);
      }

      function deleteWorkflow(id){ 
        configurations.workflows = configurations.workflows.filter(w => w.id !== id);
        updateStats(); 
        if(currentTab === 'workflows') displayTabContent('workflows');
      }

      function editSchedule(id){ 
        alert(`Edit schedule ${id}`); 
        showScheduleModal(); 
      }

      function toggleSchedule(id){ 
        const s = configurations.schedules.find(x => x.id === id); 
        if(!s) return;
        s.paused = !s.paused; 
        logStatus(`Schedule ${id} ${s.paused?'paused':'resumed'}`,'info'); 
        updateStats();
        if(currentTab === 'schedule') displayTabContent('schedule');
      }

      function deleteSchedule(id){ 
        configurations.schedules = configurations.schedules.filter(s => s.id !== id);
        updateStats(); 
        if(currentTab === 'schedule') displayTabContent('schedule');
      }

      function toggleNotifications(checked){ 
        dataStore.errorHandling.notifications = checked; 
        logStatus(`Notifications ${checked?'enabled':'disabled'}`,'info'); 
      }

      function formatDate(iso){ 
        try{ 
          return new Date(iso).toLocaleString(); 
        }catch(e){ 
          return iso; 
        } 
      }

      function updateEmailPreference(v){ 
        logStatus(`Email preference set to ${v}`,'info'); 
      }

      function updateDefaultSource(id){ 
        logStatus(`Default source set to ${id}`,'info'); 
      }

      function updateRetryAttempts(v){ 
        const n = parseInt(v,10) || 0; 
        dataStore.errorHandling.retryAttempts = n; 
        logStatus(`Retry attempts: ${n}`,'info'); 
      }

      function revokeAccess(user){ 
        dataStore.accessControl.users = dataStore.accessControl.users.filter(u => u !== user); 
        delete dataStore.accessControl.permissions[user]; 
        updateStats(); 
      }

      function getTaskName(taskId) {
        const api = configurations.api.find(a => String(a.id) === String(taskId));
        return api ? api.endpoint : 'Unknown';
      }

      function getNextScheduledRun() {
        if (!configurations.schedules.length) return '—';
        return new Date(Date.now() + 3600000).toLocaleString();
      }

      function getLastScheduledRun() {
        const last = dataStore.importHistory.at(-1);
        return last ? new Date(last.date).toLocaleString() : '—';
      }
    </script>
  </body>
</html>
